<!DOCTYPE html>
<html>
<head>
    <title>Compose2HCL Test</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/js-yaml/4.1.0/js-yaml.min.js"></script>
    <script src="compiler.js"></script>
</head>
<body>
    <h1>Compose2HCL Test</h1>
    
    <h2>Test 1: Basic Service</h2>
    <button onclick="testBasicService()">Test Basic Service</button>
    <pre id="test1-output"></pre>
    
    <h2>Test 2: Complex Service with All Features</h2>
    <button onclick="testComplexService()">Test Complex Service</button>
    <pre id="test2-output"></pre>
    
    <h2>Test 3: YAML with Comments</h2>
    <button onclick="testYAMLWithComments()">Test YAML with Comments</button>
    <pre id="test3-output"></pre>
    
    <script>
        function testBasicService() {
            const input = `services:
  web:
    image: nginx:alpine
    ports:
      - "80:80"
    environment:
      - NGINX_HOST=localhost`;
            
            try {
                const result = parseYAML(input);
                document.getElementById('test1-output').textContent = JSON.stringify(result, null, 2);
            } catch (err) {
                document.getElementById('test1-output').textContent = 'Error: ' + err.message;
            }
        }
        
        function testComplexService() {
            const input = `version: '3.8'
services:
  app:
    image: myapp:latest
    ports:
      - "3000:3000"
      - "3001:3001"
    environment:
      NODE_ENV: production
      DATABASE_URL: postgresql://user:pass@db:5432/mydb
    volumes:
      - ./app:/app
      - app_data:/data
    depends_on:
      - db
      - redis
    deploy:
      replicas: 3
      resources:
        limits:
          cpus: '0.5'
          memory: 512M
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:3000/health"]
      interval: 30s
      timeout: 10s
      retries: 3
    restart: unless-stopped
    cap_add:
      - SYS_ADMIN
    cap_drop:
      - NET_ADMIN
    gpus:
      - capabilities: [compute, utility]
        count: 1
    labels:
      app: myapp
      version: "1.0"
    logging:
      driver: json-file
      options:
        max-size: "10m"
        max-file: "3"
    networks:
      - frontend
      - backend
    configs:
      - source: app_config
        target: /app/config.yml
    secrets:
      - source: db_password
        target: /app/secrets/db_password
        mode: 0400

  db:
    image: postgres:13
    environment:
      POSTGRES_DB: mydb
      POSTGRES_USER: user
      POSTGRES_PASSWORD_FILE: /run/secrets/db_password
    volumes:
      - postgres_data:/var/lib/postgresql/data
    networks:
      - backend
    secrets:
      - db_password
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U user -d mydb"]
      interval: 10s
      timeout: 5s
      retries: 5

  redis:
    image: redis:alpine
    command: redis-server --appendonly yes
    volumes:
      - redis_data:/data
    networks:
      - backend
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 3s
      retries: 3

volumes:
  app_data:
  postgres_data:
  redis_data:

networks:
  frontend:
    driver: bridge
  backend:
    driver: bridge
    internal: true

configs:
  app_config:
    file: ./config/app.yml

secrets:
  db_password:
    file: ./secrets/db_password.txt`;
            
            try {
                const result = parseYAML(input);
                document.getElementById('test2-output').textContent = JSON.stringify(result, null, 2);
            } catch (err) {
                document.getElementById('test2-output').textContent = 'Error: ' + err.message;
            }
        }
        
        function testYAMLWithComments() {
            const input = `# This is a Docker Compose file with comments
# It should parse correctly even with # symbols

services:
  # Web service configuration
  web:
    image: nginx:alpine  # Using Alpine for smaller size
    ports:
      - "80:80"          # HTTP port
      - "443:443"        # HTTPS port
    environment:
      - NGINX_HOST=localhost  # Host configuration
      - NGINX_PORT=80         # Port configuration
    volumes:
      - ./nginx.conf:/etc/nginx/nginx.conf:ro  # Read-only config
      - ./logs:/var/log/nginx                  # Log directory
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost"]  # Health check command
      interval: 30s    # Check every 30 seconds
      timeout: 10s     # Timeout after 10 seconds
      retries: 3       # Retry 3 times before marking unhealthy
    restart: unless-stopped  # Restart policy
    deploy:
      replicas: 2      # Run 2 instances
      resources:
        limits:
          cpus: '0.5'      # CPU limit
          memory: 512M     # Memory limit

  # Database service
  db:
    image: postgres:13     # PostgreSQL 13
    environment:
      POSTGRES_DB: myapp       # Database name
      POSTGRES_USER: user      # Database user
      POSTGRES_PASSWORD: password  # Database password
    volumes:
      - postgres_data:/var/lib/postgresql/data  # Persistent data
    ports:
      - "5432:5432"        # Database port

# Named volumes
volumes:
  postgres_data:    # PostgreSQL data volume

# Networks
networks:
  default:          # Default network
    driver: bridge  # Bridge driver`;
            
            try {
                const result = parseYAML(input);
                document.getElementById('test3-output').textContent = JSON.stringify(result, null, 2);
            } catch (err) {
                document.getElementById('test3-output').textContent = 'Error: ' + err.message;
            }
        }
    </script>
</body>
</html>
